name: Simple Deploy to Render

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Trigger Render Deploy Hook
      env:
        RENDER_DEPLOY_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
      run: |
        echo "ğŸš€ Triggering Render deployment via deploy hook..."
        
        if [ -z "$RENDER_DEPLOY_HOOK" ]; then
          echo "âŒ RENDER_DEPLOY_HOOK secret not set"
          echo "ğŸ’¡ Please add your Render deploy hook URL to GitHub secrets"
          exit 1
        fi
        
        response=$(curl -s -w "\n%{http_code}" -X POST "$RENDER_DEPLOY_HOOK")
        http_code=$(echo "$response" | tail -n1)
        response_body=$(echo "$response" | head -n -1)
        
        echo "ğŸ“Š HTTP Status Code: $http_code"
        echo "ğŸ“¦ Response: $response_body"
        
        if [ "$http_code" -eq 200 ] || [ "$http_code" -eq 201 ] || [ "$http_code" -eq 204 ]; then
          echo "âœ… Deployment triggered successfully!"
          echo "ğŸ”— Check your deployment at: https://closer-app.onrender.com"
        else
          echo "âŒ Failed to trigger deployment"
          echo "Response: $response_body"
          exit 1
        fi
